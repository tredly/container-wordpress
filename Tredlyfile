#############################
#### TREDLYFILE VERSION NUMBER
versionNumber=0.9.0
#############################

# You can use variables within this file which should be interpreted by your Code repository, e.g. gitlabs or Bamboo.
# You can also configure Tredly-Build to interpret values or override values based on Partition.

################################################################################
#### CONTAINER NAME AND CONTAINER GROUP

## Container Name (required | unique per Partition | allowed=text, integer, underscore and dash)
# This should contain your AppName and version number
containerName=wordpress

## Container Group (optional, allowed= text, integers, underscore and dash)
# Only use this option if this Container is part of a group of containers
containerGroup=
## Container Options within Container Group
# Container start order (optional, required if containerGroup is entered, allowed=1-99 | default=1)
# Order in which this container is started within your containerGroup. 1 = most important 99 = least important.
# Please note that if you update one container within your containerGroup, all containers will be rebuilt
startOrder=
## Can Container be replicated within your containerGroup? (optional | required if containerGroup is entered | allowed=yes/no | default=no)
replicate=

## INFO
# Hostname of container is containerName

###########################################################################################################
#### BUILD OPTIONS
## Should Container be published on push to Tredly Host OR require manual publishing?
# On push to Tredly-Host, container will be validated and built. If publish=yes, the new container will replace the current container.
# To automatically build integration branch but manually build prod branch, you can use a variable.
# (required, | allowed=yes/no | default=yes)
publish=yes

###########################################################################################################
#### TECHNICAL OPTIONS
## Container options (optional | one per line | allowed=allow.sysvipc=1, allow.raw_sockets=true | default=blank)
# PostgreSQL requires allow.sysvipc=1 | To allow ping set allow.raw_sockets=true. Both these options may have security implications.
technicalOptions=

###########################################################################################################
### RESOURCE LIMITS
## Limit the Containers resource limits (optional).
# It is recommended that use them so that a misconfigured container or buggy software does not effect other containers.
# Container Maximum CPU in percent (optional | allowed=integer or unlimited | default=unlimited)
maxCpu=
# Container hard drive size in GB (optional | allowed=integer or unlimited | default=unlimited)
maxHdd=10
# Container Maximum RAM in GB (optional | allowed=integer or unlimited | default=unlimited)
maxRam=5


##########################################################################################################
#### FIREWALL AND PROXY CONFIGURATION

## HTTP/HTTPS (layer7) PROXY CONFIGURATION
# URL(s) the container services (optional | one per line).
# If URL has urlCert entered proxy will automatically redirect HTTP traffic to HTTPS URL. If urlCert is not specified connections to HTTPS will result in 404 error.

# URL 1
url=www.example.com
urlRedirect=www.example.com

# URL 2
url=www.example.com
urlMaxFileSize=10m

# If your container services a URL make sure you put port 443 as a tcpInPort option so this containers firewall is open
# on this port and can receive traffic from the internal HTTP proxy.

## FIREWALL
# Incoming and outgoing Ports
# Required if you want the container to be able to communicate with other container or the outside world (allowed=integer, any or blank | any=allPorts)
# One port per line, tcp 80,443 outgoing and UDP 53 outgoing are required.
tcpInPort=80
udpInPort=
tcpOutPort=80
tcpOutPort=443
udpOutPort=53

## IPV4 WHITELIST
# Restrict traffic to your container (optional | allowed= IPv4 address, subnet | default=any).
# Allowing communications between Containers in a Partition is done using containerGroup
# Examples below.
ipv4Whitelist=

##########################################################################################################
#### CUSTOM DNS SERVERS (optional | allowed=IP address or blank)
# You can specify alternative DNS servers for your container to use.
# If customDNS is blank or not specified then the internal DNS server will be used (recommended).
customDNS=

##########################################################################################################
### ORDER OF OPERATION
## This section is run in order of entry
# Options available in this section:
# 1. Container Start (onStart) and Stop (onStop) commands (optional | one per line)
# 2. Package (software) installation (optional | one per line), dependencies are also installed.
# 3. File/Folder mapping (optional | one per line | folders will be created in the container if they do not exist | Path is relative to container root (/) or partition root (partition/).

installPackage=mariadb55-server
installPackage=nginx
installPackage=php56
installPackage=mariadb55-client
installPackage=php56-mysql
installPackage=php56-xml
installPackage=php56-hash
installPackage=php56-gd
installPackage=php56-curl
installPackage=php56-tokenizer
installPackage=php56-zlib
installPackage=php56-zip


fileFolderMapping= /mysql/install.sql /usr/local/
fileFolderMapping= /nginx/nginx.conf /usr/local/etc/nginx/
fileFolderMapping= /php-fpm/php.ini /usr/local/etc/
fileFolderMapping= /wordpress/wp-config.php /usr/local/www/wordpress/

onStart= echo nginx_enable=\\"YES\\" >> /etc/rc.conf && service nginx start
onStart= echo php_fpm_enable=\\"YES\\" >> /etc/rc.conf && service php-fpm start
onStart= echo mysql_enable=\\"YES\\" >> /etc/rc.conf && service mysql-server start

onStart= chmod 1777 /tmp
onStart= cd /usr/local/ && mysql_install_db --user=mysql --basedir=/usr/local --basedir=/usr/local --datadir=/var/db/mysql
onStart= mysql -uroot < /usr/local/install.sql

onStart= cd /tmp && fetch http://wordpress.org/latest.tar.gz && tar xzvf /tmp/latest.tar.gz
onStart= rm /tmp/latest.tar.gz

onStart= cp -R /tmp/wordpress /usr/local/www
onStart= rm -rf /tmp/wordpress
onStart= chown -R www:www /usr/local/www/wordpress

############################################
## ON CONTAINER STOP COMMANDS
## Commands run when container stops or is terminated (one per line, optional)
onStop=

## END ORDER OF ENTRY
##########################################################################################################
#### END OF FILE